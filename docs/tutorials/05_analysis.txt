
The Analysis module of Pandora allows the user to calculate basic statistics generated from the data stored during a simulation. This tutorial will define how to use it using the C++ interface of the framework. These analysis generate a set of csv files (Comma Separated Values) that can be loaded from any spreadsheet application (like LibreOffice Calc), as well as from several statistical packages (like R).

We will generate a basic dataset, and will try to load it afterwards.
First of all let's create the simulation. Follow the tutorial (ENLLAÃ‡ GETTING STARTED PYPANDORA) and execute the simulation. It will create a folder called 'data' with the files 'gujarat.h5' and 'agents-0.abm' in it. These files contain the data from rasters and agents collected during each time step.

Create a folder called inside examples:

- PANDORA_ROOT
	- examples
		- 05_src

And define a new file 'main.cxx', where we will program the analysis. In order to do that, we need to load it into an instance of the class SimulationRecord:

#include <SimulationRecord.hxx>

int main(int argc, char *argv[])
{
	Engine::SimulationRecord simRecord( 1, false);
	simRecord.loadHDF5("data/results.h5", true, true);
}


These lines create a SimulationRecord and loads the file 'data/results.h5'. If the folder generated by the simulation is in another path please use it. The parameters of the constructor are the resolution at which data must be loaded (we have specified to load every time step, but you could also define a resolution of 10, thus loading a time step every ten). The third parameter specifies that this SimulationRecord will not be displayed on a GUI (like Cassandra), thus showing the progress of the task in command line.

The method loadHDF5 has three parameters.  The first one is the file to be loaded, and the other ones allows the user to specify if agents and rasters must be loaded (flag set to true) or not (flag set to false).

Once that data is loaded, we will create a set of tools to analyze the agents, as well as the values of the rasters. This is done using the classes AgentResults and RasterResults. The constructors of both of them need to specify the instance of SimulationRecord used, the output file, the agent type or raster to be analyzed and, finally, the separator:

Analysis::AgentResults agentResults(simRecord, "agents.csv", "MyAgent", ";");
Analysis::RasterResults rasterResults(simRecord, "rasters.csv", "resources", ";");

We will add several analysis to both of them. Each analysis is a different class, and has a different set of parameters, for example:

agentResults.addAnalysis(new Analysis::AgentNum());
agentResults.addAnalysis(new Analysis::AgentMean("x"));
agentResults.addAnalysis(new Analysis::AgentMean("y"));
agentResults.addAnalysis(new Analysis::AgentMean("resources"));
agentResults.addAnalysis(new Analysis::AgentSum("resources"));
agentResults.addAnalysis(new Analysis::AgentHDFtoSHP( "shp/agents.shp'", -1));

The first analysis stores the number of agents for each time step. The second, third and fourth one compute the mean of each variable amongst the entire set of agents. The fifth one calculates the sum of values, and finally the last analysis generate a georeferenced file (Shapefile http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf) that can be loaded by any GIS software.

Regarding rasters, given the fact that each instance of RasterResults is defined for a raster, we can calculate the Mean and Sum of values:

rasterResults.addAnalysis(new Analysis::RasterMean());
rasterResults.addAnalysis(new Analysis::RasterSum());		

Finally, we will need to add these classes in the include section:

#include <analysis/Results.hxx>
#include <analysis/AgentMean.hxx>
#include <analysis/AgentSum.hxx>
#include <analysis/RasterMean.hxx>
#include <analysis/RasterSum.hxx>
#include <analysis/AgentNum.hxx>
#include <analysis/AgentHDFtoSHP.hxx>


and compute results:

agentResults.apply();
rasterResults.apply();

To compile and execute the example you can use the scons file located in $PANDORA_ROOT/doc/tutorials/05_src/
